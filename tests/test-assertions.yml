---
- hosts: localhost
  remote_user: root

  vars:
    autofs_indirect_maps:
      - name: auto.stuff
        path: "/stuff"
        enabled: "true"
        autofsoptions: "--timeout 1800"
        mode: "0755"

    enabled_autofs_indirect_maps:
      - "auto.stuff"

  roles:
    - role_under_test

  tasks:
    - stat:
        path: "/etc/auto.master.d/stuff.autofs"
      register: autostuff

    - name: "TEST | Test File Defaults"
      shell: "grep 'timeout 1800' /etc/auto.master.d/stuff.autofs"
      register: autogrep

    - assert:
        that:
          - "autostuff.stat.exists == true"
          - "autogrep.rc == 0"
